<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AI Trading Dashboard</title>
    <script src="/static/js/socket.io.min.js"></script>
    <script src="/static/js/plotly-latest.min.js"></script>
    <script src="/static/js/chart.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-align: center;
        }

        .header p {
            color: #7f8c8d;
            text-align: center;
            font-size: 1.1em;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ecf0f1;
            background: #f8f9fa;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            color: #7f8c8d;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            text-align: center;
        }

        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
            background: white;
        }

        .tab-button:hover {
            background: rgba(52, 152, 219, 0.05);
            color: #3498db;
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }

        .portfolio-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }

        .metric h3 {
            font-size: 0.9em;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .metric .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .positive { color: #27ae60; }
        .negative { color: #e74c3c; }

        .chart-container {
            height: 400px;
            margin-top: 15px;
        }

        .trading-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online { background: #27ae60; }
        .status-offline { background: #e74c3c; }

        .positions-table, .tickers-table, .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            min-width: 600px; /* Ensure minimum width for readability */
        }

        .positions-table th,
        .positions-table td,
        .tickers-table th,
        .tickers-table td,
        .trades-table th,
        .trades-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
            white-space: nowrap; /* Prevent text wrapping */
        }

        .positions-table th,
        .tickers-table th,
        .trades-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Table container with scrolling */
        .table-container {
            width: 100%;
            overflow-x: auto;
            overflow-y: auto;
            max-height: 400px;
            border: 1px solid #ecf0f1;
            border-radius: 8px;
            background: white;
        }

        /* Responsive table wrapper */
        .table-wrapper {
            width: 100%;
            overflow: hidden;
            border-radius: 8px;
        }

        /* Responsive design for smaller screens */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 15px;
            }
            
            .card h2 {
                font-size: 1.3em;
            }
            
            .table-container {
                max-height: 300px;
            }
            
            .positions-table th,
            .positions-table td,
            .tickers-table th,
            .tickers-table td,
            .trades-table th,
            .trades-table td {
                padding: 8px;
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {
            .card h2 {
                font-size: 1.2em;
            }
            
            .table-container {
                max-height: 250px;
            }
            
            .positions-table th,
            .positions-table td,
            .tickers-table th,
            .tickers-table td,
            .trades-table th,
            .trades-table td {
                padding: 6px;
                font-size: 0.8em;
            }
        }

        .tickers-table tr:hover,
        .trades-table tr:hover {
            background: rgba(52, 152, 219, 0.05);
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .backtest-results {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .backtest-results h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .backtest-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .backtest-metric {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .backtest-metric h4 {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .backtest-metric .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .indicator-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .indicator-bullish { background: #27ae60; color: white; }
        .indicator-bearish { background: #e74c3c; color: white; }
        .indicator-neutral { background: #f39c12; color: white; }

        .score-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .score-high { background: #27ae60; color: white; }
        .score-medium { background: #f39c12; color: white; }
        .score-low { background: #e74c3c; color: white; }

        /* Market Indexes Styles */
        .index-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .index-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .index-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* Backtest Period Button Styles */
        .btn-secondary.active {
            background: #3498db !important;
            color: white !important;
            border-color: #3498db !important;
            box-shadow: 0 2px 4px rgba(52, 152, 219, 0.3) !important;
        }

        .btn-secondary:hover {
            background: #2980b9 !important;
            border-color: #2980b9 !important;
        }

        .index-symbol {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .index-name {
            font-size: 0.8em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .index-price {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .index-change {
            font-size: 0.9em;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .index-change.positive {
            background: rgba(39, 174, 96, 0.8);
            color: white;
        }

        .index-change.negative {
            background: rgba(231, 76, 60, 0.8);
            color: white;
        }

        .index-change.neutral {
            background: rgba(127, 140, 141, 0.8);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .tab-buttons {
                flex-direction: column;
            }
        }

        .trades-table th {
            background: #34495e;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-value.positive {
            color: #27ae60;
        }
        
        .stat-value.negative {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI Trading Dashboard</h1>
            <p>Real-time monitoring and control for your automated trading system</p>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <div class="tab-buttons">
                            <button class="tab-button active" data-tab="overview">📊 Overview</button>
            <button class="tab-button" data-tab="tickers">📈 Tickers & Scoring</button>
            <button class="tab-button" data-tab="trades">📋 Trade History</button>
            <button class="tab-button" data-tab="backtesting">🧪 Backtesting</button>
            <button class="tab-button" data-tab="automation">🤖 Automation</button>
            <button class="tab-button" data-tab="historical-backtest">📈 Historical Backtest</button>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="dashboard-grid">
                    <!-- Portfolio Overview -->
                    <div class="card">
                        <h2>📊 Portfolio Overview</h2>
                        <div id="portfolio-summary" class="portfolio-summary">
                            <div class="metric">
                                <h3>Total Value</h3>
                                <div class="value" id="total-value">$0.00</div>
                            </div>
                            <div class="metric">
                                <h3>Daily P&L</h3>
                                <div class="value" id="daily-pnl">$0.00</div>
                            </div>
                            <div class="metric">
                                <h3>Total P&L</h3>
                                <div class="value" id="total-pnl">$0.00</div>
                            </div>
                            <div class="metric">
                                <h3>Positions</h3>
                                <div class="value" id="position-count">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Trading Status -->
                    <div class="card">
                        <h2>⚡ Trading Status</h2>
                        <div id="trading-status">
                            <p><span class="status-indicator status-offline" id="status-indicator"></span>
                               <span id="status-text">Offline</span></p>
                            <p>Market: <span id="market-status">Closed</span></p>
                            <p>Daily Trades: <span id="daily-trades">0</span></p>
                            <div class="trading-controls">
                                <button class="btn btn-success" id="start-trading-btn">Start Trading</button>
                                <button class="btn btn-danger" id="stop-trading-btn">Stop Trading</button>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Chart -->
                    <div class="card">
                        <h2>📈 Performance Chart</h2>
                        <div id="performance-chart" class="chart-container"></div>
                    </div>

                    <!-- Portfolio Positions -->
                    <div class="card">
                        <h2>💼 Portfolio Positions</h2>
                        <div id="positions-container">
                            <div class="table-wrapper">
                                <div class="table-container">
                                    <table class="positions-table" id="positions-table">
                                        <thead>
                                            <tr>
                                                <th>Symbol</th>
                                                <th>Shares</th>
                                                <th>Avg Price</th>
                                                <th>Current Price</th>
                                                <th>P&L</th>
                                                <th>P&L %</th>
                                            </tr>
                                        </thead>
                                        <tbody id="positions-tbody">
                                            <tr>
                                                <td colspan="6" class="loading">Loading positions...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Market Indexes -->
                    <div class="card">
                        <h2>🌍 Market Indexes</h2>
                        <div id="market-indexes">
                            <div class="index-grid">
                                <div class="index-item" id="spy-index">
                                    <div class="index-symbol">SPY</div>
                                    <div class="index-name">S&P 500 ETF</div>
                                    <div class="index-price" id="spy-price">$0.00</div>
                                    <div class="index-change" id="spy-change">0.00%</div>
                                </div>
                                <div class="index-item" id="qqq-index">
                                    <div class="index-symbol">QQQ</div>
                                    <div class="index-name">NASDAQ-100 ETF</div>
                                    <div class="index-price" id="qqq-price">$0.00</div>
                                    <div class="index-change" id="qqq-change">0.00%</div>
                                </div>
                                <div class="index-item" id="dia-index">
                                    <div class="index-symbol">DIA</div>
                                    <div class="index-name">Dow Jones ETF</div>
                                    <div class="index-price" id="dia-price">$0.00</div>
                                    <div class="index-change" id="dia-change">0.00%</div>
                                </div>
                                <div class="index-item" id="vix-index">
                                    <div class="index-symbol">VIX</div>
                                    <div class="index-name">Volatility Index</div>
                                    <div class="index-price" id="vix-price">$0.00</div>
                                    <div class="index-change" id="vix-change">0.00%</div>
                                </div>
                            </div>
                            <div style="margin-top: 15px; text-align: center;">
                                <small style="color: #7f8c8d;">Last updated: <span id="indexes-last-update">Never</span></small>
                            </div>
                        </div>
                    </div>

                    <!-- System Info -->
                    <div class="card">
                        <h2>⚙️ System Information</h2>
                        <div id="system-info">
                            <p><strong>Last Update:</strong> <span id="last-update">Never</span></p>
                            <p><strong>Data Engine:</strong> <span id="data-engine-status">Online</span></p>
                            <p><strong>ML Models:</strong> <span id="ml-status">Available</span></p>
                            <p><strong>Risk Management:</strong> <span id="risk-status">Active</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tickers & Scoring Tab -->
            <div id="tickers" class="tab-content">
                <div class="card">
                    <h2>📈 Tickers & Scoring</h2>
                    
                    <!-- Ticker Search and Add Section -->
                    <div id="ticker-search-section" style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; border: 4px solid #3498db; box-shadow: 0 8px 32px rgba(52, 152, 219, 0.3); position: relative;">
                        <div style="position: absolute; top: -10px; left: 20px; background: #3498db; color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: bold;">SEARCH AREA</div>
                        <h3 style="margin-bottom: 15px; color: white; font-size: 1.3em; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">🔍 Add New Ticker</h3>
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <input type="text" id="ticker-search" placeholder="Enter ticker symbol (e.g., AAPL, MSFT)" 
                                   style="flex: 1; min-width: 200px; padding: 15px; border: 3px solid #3498db; border-radius: 8px; font-size: 16px; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <button id="search-ticker-btn" class="btn btn-primary" style="padding: 15px 25px; font-weight: bold; font-size: 16px; background: #e74c3c; border: none; box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);">🔍 Search</button>
                            <button id="add-ticker-btn" class="btn btn-success" style="padding: 15px 25px; display: none; font-weight: bold; font-size: 16px; background: #27ae60; border: none; box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);">➕ Add to Watchlist</button>
                        </div>
                        <div id="search-results" style="margin-top: 15px; display: none;">
                            <!-- Search results will appear here -->
                        </div>
                    </div>
                    
                    <div id="tickers-container">
                        <div class="table-wrapper">
                            <div class="table-container">
                                <table class="tickers-table" id="tickers-table">
                                    <thead>
                                        <tr>
                                            <th>Symbol</th>
                                            <th>Current Price</th>
                                            <th>Score</th>
                                            <th>MACD</th>
                                            <th>RSI</th>
                                            <th>EMA</th>
                                            <th>BB Position</th>
                                            <th>Volume</th>
                                            <th>Signal</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tickers-tbody">
                                        <tr>
                                            <td colspan="10" class="loading">Loading tickers...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trade History Tab -->
            <div id="trades" class="tab-content">
                <div class="card">
                    <h2>📋 Trade History</h2>
                    
                    <!-- Trade Statistics -->
                    <div id="trade-statistics" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h3>📊 Trade Statistics</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="stat-card">
                                <div class="stat-label">Total Trades</div>
                                <div class="stat-value" id="total-trades">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Win Rate</div>
                                <div class="stat-value" id="win-rate">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Avg P&L %</div>
                                <div class="stat-value" id="avg-pnl">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Total P&L</div>
                                <div class="stat-value" id="total-pnl">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="trades-container">
                        <div class="table-wrapper">
                            <div class="table-container">
                                <table class="trades-table" id="trades-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Symbol</th>
                                            <th>Type</th>
                                            <th>Shares</th>
                                            <th>Price</th>
                                            <th>P&L</th>
                                            <th>Strategy</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="trades-tbody">
                                        <tr>
                                            <td colspan="8" class="loading">Loading trades...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Backtesting Tab -->
            <div id="backtesting" class="tab-content">
                <div class="card">
                    <h2>🧪 Backtesting</h2>
                    <div id="backtest-form">
                        <div style="margin-bottom: 15px;">
                            <label for="backtest-symbol">Symbol:</label>
                            <div style="display: flex; align-items: center; margin-left: 10px;">
                                <input type="text" id="symbol-search" placeholder="Search symbols..." style="padding: 5px; border: 1px solid #ddd; border-radius: 4px; margin-right: 5px; width: 150px;">
                                <select id="backtest-symbol" style="padding: 5px; min-width: 100px;">
                                    <option value="AAPL">AAPL</option>
                                    <option value="MSFT">MSFT</option>
                                    <option value="GOOGL">GOOGL</option>
                                    <option value="TSLA">TSLA</option>
                                </select>
                                <button type="button" id="search-symbol-btn" class="btn btn-secondary" style="margin-left: 5px; padding: 5px 10px; font-size: 12px;">🔍</button>
                            </div>
                            <div id="symbol-search-results" style="display: none; margin-top: 5px; max-height: 150px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; background: white; position: absolute; z-index: 1000; width: 200px;"></div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="backtest-strategy">Strategy:</label>
                            <select id="backtest-strategy" style="margin-left: 10px; padding: 5px;">
                                <option value="MACD">MACD Strategy</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="backtest-profile">Profile:</label>
                            <select id="backtest-profile" style="margin-left: 10px; padding: 5px;">
                                <option value="balanced">Balanced</option>
                                <option value="canonical">Canonical</option>
                                <option value="aggressive">Aggressive</option>
                                <option value="conservative">Conservative</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="backtest-start-date">Start Date:</label>
                            <input type="date" id="backtest-start-date" style="margin-left: 10px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="backtest-end-date">End Date:</label>
                            <input type="date" id="backtest-end-date" style="margin-left: 10px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        
                        <!-- Strategy Parameters Section -->
                        <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #e74c3c;">
                            <h4 style="margin-bottom: 10px; color: #2c3e50; cursor: pointer;" onclick="toggleStrategyParameters()">
                                ⚙️ Strategy Parameters <span id="params-toggle">▼</span>
                            </h4>
                            <div id="strategy-parameters" style="display: none;">
                                <div id="parameters-content">
                                    <div style="text-align: center; color: #7f8c8d; padding: 20px;">
                                        Select a strategy to view and customize parameters
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <button type="button" class="btn btn-secondary" onclick="resetToDefaults()" style="margin-right: 10px;">Reset to Defaults</button>
                                    <button type="button" class="btn btn-info" onclick="loadStrategyParameters()">Load Current Strategy</button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label>Quick Periods:</label>
                            <div style="margin-top: 5px;">
                                <button type="button" class="btn btn-secondary" style="margin-right: 5px; padding: 5px 10px; font-size: 12px;" onclick="setBacktestPeriod('1M')">1 Month</button>
                                <button type="button" class="btn btn-secondary" style="margin-right: 5px; padding: 5px 10px; font-size: 12px;" onclick="setBacktestPeriod('3M')">3 Months</button>
                                <button type="button" class="btn btn-secondary" style="margin-right: 5px; padding: 5px 10px; font-size: 12px;" onclick="setBacktestPeriod('6M')">6 Months</button>
                                <button type="button" class="btn btn-secondary" style="margin-right: 5px; padding: 5px 10px; font-size: 12px;" onclick="setBacktestPeriod('1Y')">1 Year</button>
                                <button type="button" class="btn btn-secondary" style="margin-right: 5px; padding: 5px 10px; font-size: 12px;" onclick="setBacktestPeriod('2Y')">2 Years</button>
                                <button type="button" class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="setBacktestPeriod('5Y')">5 Years</button>
                            </div>
                        </div>
                        <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                            <h4 style="margin-bottom: 10px; color: #2c3e50;">📋 Strategy Descriptions</h4>
                            <div id="strategy-description" style="font-size: 0.9em; color: #555; line-height: 1.4;">
                                <strong>MACD Canonical:</strong> Pure MACD crossover strategy without additional filters. Only uses MACD line crossing above/below signal line.<br>
                                <strong>MACD Strategy:</strong> MACD with RSI and EMA filters. Requires RSI in neutral range and price above EMAs.<br>
                                <strong>MACD Aggressive:</strong> Looser filters with higher position sizing and more frequent trades.<br>
                                <strong>MACD Conservative:</strong> Strict filters with lower position sizing and fewer, higher-quality trades.
                            </div>
                        </div>
                        <button class="btn btn-primary" id="run-backtest-btn">Run Backtest</button>
                    </div>
                    <div id="backtest-results" class="backtest-results" style="display: none;">
                        <h3>📊 Backtest Results</h3>
                        <div class="backtest-metrics" id="backtest-metrics">
                            <!-- Summary Metrics -->
                            <div class="backtest-summary" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                                <h4 style="margin-bottom: 10px; color: #2c3e50;">📈 Summary</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                    <div class="metric-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Total Trades</div>
                                        <div id="total-trades" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">0</div>
                                    </div>
                                    <div class="metric-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Total Return</div>
                                        <div id="total-return" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">0%</div>
                                    </div>
                                    <div class="metric-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Final Value</div>
                                        <div id="final-value" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">$0</div>
                                    </div>
                                    <div class="metric-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Sharpe Ratio</div>
                                        <div id="sharpe-ratio" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">0.00</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Benchmark Comparison -->
                            <div class="benchmark-comparison" style="margin-bottom: 20px; padding: 15px; background: #e8f4fd; border-radius: 10px; border-left: 4px solid #3498db;">
                                <h4 style="margin-bottom: 10px; color: #2c3e50;">🏆 Benchmark Comparison</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                    <div class="benchmark-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Strategy Return</div>
                                        <div id="strategy-return" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">0%</div>
                                    </div>
                                    <div class="benchmark-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Benchmark Return</div>
                                        <div id="benchmark-return" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">0%</div>
                                    </div>
                                    <div class="benchmark-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Alpha (Excess Return)</div>
                                        <div id="alpha-return" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">0%</div>
                                    </div>
                                    <div class="benchmark-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Outperformance</div>
                                        <div id="outperformance" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">-</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Performance Chart -->
                            <div class="performance-chart" style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px; color: #2c3e50;">📈 Performance Chart</h4>
                                <div id="backtest-chart" style="height: 300px; background: white; border-radius: 8px; padding: 20px;">
                                    <div style="text-align: center; color: #7f8c8d; padding-top: 120px;">Chart will appear here</div>
                                </div>
                            </div>
                        </div>
                        

                        
                        <!-- Backtest Logs - Moved to bottom with full width -->
                        <div class="backtest-logs" style="margin-bottom: 20px; width: 100%;">
                            <h4 style="margin-bottom: 10px; color: #2c3e50;">🖥️ Backtest Logs</h4>
                            <div id="backtest-log-container" style="width: 100%; background: #1e1e1e; color: #00ff00; font-family: 'Courier New', monospace; padding: 15px; border-radius: 8px; height: 300px; overflow-y: auto; font-size: 12px; border: 1px solid #333; box-sizing: border-box;">
                                <div id="backtest-log-content">
                                    <span style="color: #888;">Waiting for backtest to start...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Automation Tab -->
            <div id="automation" class="tab-content">
                <div class="dashboard-grid">
                    <!-- Automation Status -->
                    <div class="card">
                        <h2>🤖 Automation Status</h2>
                        <div id="automation-status">
                            <p><span class="status-indicator status-offline" id="automation-status-indicator"></span>
                               <span id="automation-status-text">Stopped</span></p>
                            <p>Mode: <span id="automation-mode">Paper Trading</span></p>
                            <p>Last Cycle: <span id="last-cycle-time">Never</span></p>
                            <p>Cycles Today: <span id="cycles-today">0</span></p>
                            <div class="trading-controls">
                                <button class="btn btn-success" id="start-automation-btn">Start Automation</button>
                                <button class="btn btn-danger" id="stop-automation-btn">Stop Automation</button>
                                <button class="btn btn-primary" id="run-cycle-btn">Run Cycle</button>
                            </div>
                        </div>
                    </div>

                    <!-- Automation Configuration -->
                    <div class="card">
                        <h2>⚙️ Configuration</h2>
                        <div id="automation-config">
                            <div style="margin-bottom: 15px;">
                                <label for="automation-mode-select">Mode:</label>
                                <select id="automation-mode-select" style="margin-left: 10px; padding: 5px;">
                                    <option value="paper_trading">Paper Trading</option>
                                    <option value="semi_auto">Semi-Automatic</option>
                                    <option value="full_auto">Full Automatic</option>
                                    <option value="manual">Manual</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="max-positions">Max Positions:</label>
                                <input type="number" id="max-positions" value="5" min="1" max="20" style="margin-left: 10px; padding: 5px; width: 80px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="position-size">Position Size (%):</label>
                                <input type="number" id="position-size" value="20" min="5" max="100" style="margin-left: 10px; padding: 5px; width: 80px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="stop-loss">Stop Loss (%):</label>
                                <input type="number" id="stop-loss" value="5" min="1" max="20" style="margin-left: 10px; padding: 5px; width: 80px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="take-profit">Take Profit (%):</label>
                                <input type="number" id="take-profit" value="15" min="5" max="50" style="margin-left: 10px; padding: 5px; width: 80px;">
                            </div>
                            <button class="btn btn-primary" id="save-config-btn">Save Configuration</button>
                        </div>
                    </div>

                    <!-- Automation Performance -->
                    <div class="card">
                        <h2>📊 Performance Metrics</h2>
                        <div id="automation-performance">
                            <div class="portfolio-summary">
                                <div class="metric">
                                    <h3>Total P&L</h3>
                                    <div class="value" id="automation-total-pnl">$0.00</div>
                                </div>
                                <div class="metric">
                                    <h3>Win Rate</h3>
                                    <div class="value" id="automation-win-rate">0%</div>
                                </div>
                                <div class="metric">
                                    <h3>Avg Return</h3>
                                    <div class="value" id="automation-avg-return">0%</div>
                                </div>
                                <div class="metric">
                                    <h3>Sharpe Ratio</h3>
                                    <div class="value" id="automation-sharpe">0.00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Automation Positions -->
                    <div class="card">
                        <h2>💼 Active Positions</h2>
                        <div id="automation-positions">
                            <div class="table-wrapper">
                                <div class="table-container">
                                    <table class="positions-table" id="automation-positions-table">
                                        <thead>
                                            <tr>
                                                <th>Symbol</th>
                                                <th>Shares</th>
                                                <th>Entry Price</th>
                                                <th>Current Price</th>
                                                <th>P&L</th>
                                                <th>P&L %</th>
                                                <th>Duration</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="automation-positions-tbody">
                                            <tr>
                                                <td colspan="8" class="loading">Loading positions...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Automation Logs -->
                    <div class="card">
                        <h2>📝 Activity Log</h2>
                        <div id="automation-logs">
                            <div id="automation-log-container" style="background: #1e1e1e; color: #00ff00; font-family: 'Courier New', monospace; padding: 15px; border-radius: 8px; height: 300px; overflow-y: auto; font-size: 12px; border: 1px solid #333;">
                                <div id="automation-log-content">
                                    <span style="color: #888;">Automation logs will appear here...</span>
                                </div>
                            </div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-secondary" id="clear-logs-btn">Clear Logs</button>
                                <button class="btn btn-secondary" id="export-logs-btn">Export Logs</button>
                            </div>
                        </div>
                    </div>

                    <!-- Watchlist Management -->
                    <div class="card">
                        <h2>👀 Watchlist</h2>
                        <div id="automation-watchlist">
                            <div style="margin-bottom: 15px;">
                                <input type="text" id="watchlist-add" placeholder="Add symbol to watchlist" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <button class="btn btn-success" id="add-to-watchlist-btn">Add</button>
                            </div>
                            <div id="watchlist-container">
                                <div id="watchlist-symbols" style="display: flex; flex-wrap: wrap; gap: 10px;">
                                    <!-- Watchlist symbols will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Historical Backtest Tab -->
            <div id="historical-backtest" class="tab-content">
                <div class="dashboard-grid">
                    <!-- Historical Backtest Controls -->
                    <div class="card">
                        <h2>📈 Historical Backtest</h2>
                        <div id="historical-backtest-controls">
                            <div style="margin-bottom: 15px;">
                                <label for="backtest-period">Time Period:</label>
                                <select id="backtest-period" style="margin-left: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="1m">1 Month</option>
                                    <option value="6m">6 Months</option>
                                    <option value="1y" selected>1 Year</option>
                                    <option value="2y">2 Years</option>
                                    <option value="3y">3 Years</option>
                                    <option value="5y">5 Years</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="backtest-benchmark">Benchmark:</label>
                                <select id="backtest-benchmark" style="margin-left: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="SPY" selected>S&P 500 (SPY)</option>
                                    <option value="QQQ">NASDAQ 100 (QQQ)</option>
                                    <option value="IWM">Russell 2000 (IWM)</option>
                                    <option value="DIA">Dow Jones (DIA)</option>
                                    <option value="VTI">Total Stock Market (VTI)</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="historical-backtest-strategy">Strategy:</label>
                                <select id="historical-backtest-strategy" style="margin-left: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="MACD">MACD Strategy</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="historical-backtest-profile">Profile:</label>
                                <select id="historical-backtest-profile" style="margin-left: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="balanced">Balanced</option>
                                    <option value="canonical">Canonical</option>
                                    <option value="aggressive">Aggressive</option>
                                    <option value="conservative">Conservative</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="backtest-start-date">Start Date:</label>
                                <input type="date" id="backtest-start-date" style="margin-left: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="backtest-end-date">End Date:</label>
                                <input type="date" id="backtest-end-date" style="margin-left: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div class="trading-controls">
                                <button class="btn btn-success" id="run-historical-backtest-btn">Run Historical Backtest</button>
                                <button class="btn btn-secondary" id="clear-historical-results-btn">Clear Results</button>
                            </div>
                        </div>
                    </div>

                    <!-- Historical Backtest Results -->
                    <div class="card">
                        <h2>📊 Backtest Results</h2>
                        <div id="historical-backtest-results">
                            <div class="portfolio-summary">
                                <div class="metric">
                                    <h3>Strategy Return</h3>
                                    <div class="value" id="historical-strategy-return">0%</div>
                                </div>
                                <div class="metric">
                                    <h3>Benchmark Return</h3>
                                    <div class="value" id="historical-benchmark-return">0%</div>
                                </div>
                                <div class="metric">
                                    <h3>Alpha (Excess)</h3>
                                    <div class="value" id="historical-alpha-return">0%</div>
                                </div>
                                <div class="metric">
                                    <h3>Sharpe Ratio</h3>
                                    <div class="value" id="historical-sharpe-ratio">0.00</div>
                                </div>
                            </div>
                            <div style="margin-top: 15px;">
                                <div class="metric">
                                    <h3>Max Drawdown</h3>
                                    <div class="value" id="historical-max-drawdown">0%</div>
                                </div>
                                <div class="metric">
                                    <h3>Total Trades</h3>
                                    <div class="value" id="historical-total-trades">0</div>
                                </div>
                                <div class="metric">
                                    <h3>Win Rate</h3>
                                    <div class="value" id="historical-win-rate">0%</div>
                                </div>
                                <div class="metric">
                                    <h3>Avg Trade Return</h3>
                                    <div class="value" id="historical-avg-trade-return">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Historical Backtest Chart -->
                    <div class="card">
                        <h2>📈 Performance Chart</h2>
                        <div id="historical-backtest-chart" style="height: 400px; background: white; border-radius: 8px; padding: 20px;">
                            <div style="text-align: center; color: #7f8c8d; padding-top: 180px;">Chart will appear here after running backtest</div>
                        </div>
                    </div>

                    <!-- Historical Backtest Trades -->
                    <div class="card">
                        <h2>📋 Trade History</h2>
                        <div id="historical-backtest-trades">
                            <div class="table-wrapper">
                                <div class="table-container">
                                    <table class="trades-table" id="historical-trades-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Symbol</th>
                                                <th>Action</th>
                                                <th>Shares</th>
                                                <th>Price</th>
                                                <th>Value</th>
                                                <th>P&L</th>
                                                <th>P&L %</th>
                                                <th>Strategy</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historical-trades-tbody">
                                            <tr>
                                                <td colspan="9" class="loading">No trades yet. Run a backtest to see results.</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Historical Backtest Logs -->
                    <div class="card">
                        <h2>🖥️ Backtest Logs</h2>
                        <div id="historical-backtest-logs">
                            <div id="historical-log-container" style="background: #1e1e1e; color: #00ff00; font-family: 'Courier New', monospace; padding: 15px; border-radius: 8px; height: 300px; overflow-y: auto; font-size: 12px; border: 1px solid #333;">
                                <div id="historical-log-content">
                                    <span style="color: #888;">Historical backtest logs will appear here...</span>
                                </div>
                            </div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-secondary" id="clear-historical-logs-btn">Clear Logs</button>
                                <button class="btn btn-secondary" id="export-historical-logs-btn">Export Logs</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trade Detail Modal -->
    <div id="tradeModal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-modal-btn">&times;</span>
            <h2 id="modal-title">Trade Details</h2>
            <div id="modal-content">
                <!-- Trade details will be populated here -->
            </div>
        </div>
    </div>
</body>
</html>
