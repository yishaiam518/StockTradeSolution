<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AI Trading Dashboard</title>
    <script src="/static/js/socket.io.min.js"></script>
    <script src="/static/js/plotly-latest.min.js"></script>
    <script src="/static/js/chart.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-align: center;
        }

        .header p {
            color: #7f8c8d;
            text-align: center;
            font-size: 1.1em;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ecf0f1;
            background: #f8f9fa;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            color: #7f8c8d;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            text-align: center;
        }

        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
            background: white;
        }

        .tab-button:hover {
            background: rgba(52, 152, 219, 0.05);
            color: #3498db;
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .portfolio-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }

        .metric h3 {
            font-size: 0.9em;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .metric .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .positive { color: #27ae60; }
        .negative { color: #e74c3c; }

        .chart-container {
            height: 400px;
            margin-top: 15px;
        }

        .trading-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online { background: #27ae60; }
        .status-offline { background: #e74c3c; }

        .positions-table, .tickers-table, .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .positions-table th,
        .positions-table td,
        .tickers-table th,
        .tickers-table td,
        .trades-table th,
        .trades-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .positions-table th,
        .tickers-table th,
        .trades-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .tickers-table tr:hover,
        .trades-table tr:hover {
            background: rgba(52, 152, 219, 0.05);
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .backtest-results {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .backtest-results h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .backtest-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .backtest-metric {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .backtest-metric h4 {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .backtest-metric .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .indicator-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .indicator-bullish { background: #27ae60; color: white; }
        .indicator-bearish { background: #e74c3c; color: white; }
        .indicator-neutral { background: #f39c12; color: white; }

        .score-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .score-high { background: #27ae60; color: white; }
        .score-medium { background: #f39c12; color: white; }
        .score-low { background: #e74c3c; color: white; }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .tab-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI Trading Dashboard</h1>
            <p>Real-time monitoring and control for your automated trading system</p>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation" style="margin-bottom: 20px; background: white; border-radius: 15px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);">
            <div class="tab-buttons" style="display: flex; border-bottom: 1px solid #ecf0f1; background: #f8f9fa;">
                <button class="tab-button active" data-tab="overview" style="flex: 1; padding: 15px 20px; background: none; border: none; cursor: pointer; font-size: 1.1em; font-weight: 500; color: #7f8c8d; transition: all 0.3s ease; border-bottom: 3px solid transparent; text-align: center;">📊 Overview</button>
                <button class="tab-button" data-tab="tickers" style="flex: 1; padding: 15px 20px; background: none; border: none; cursor: pointer; font-size: 1.1em; font-weight: 500; color: #7f8c8d; transition: all 0.3s ease; border-bottom: 3px solid transparent; text-align: center;">📈 Tickers & Scoring</button>
                <button class="tab-button" data-tab="trades" style="flex: 1; padding: 15px 20px; background: none; border: none; cursor: pointer; font-size: 1.1em; font-weight: 500; color: #7f8c8d; transition: all 0.3s ease; border-bottom: 3px solid transparent; text-align: center;">📋 Trade History</button>
                <button class="tab-button" data-tab="backtesting" style="flex: 1; padding: 15px 20px; background: none; border: none; cursor: pointer; font-size: 1.1em; font-weight: 500; color: #7f8c8d; transition: all 0.3s ease; border-bottom: 3px solid transparent; text-align: center;">🧪 Backtesting</button>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active" style="display: block; padding: 20px;">
                <div class="dashboard-grid">
                    <!-- Portfolio Overview -->
                    <div class="card">
                        <h2>📊 Portfolio Overview</h2>
                        <div id="portfolio-summary" class="portfolio-summary">
                            <div class="metric">
                                <h3>Total Value</h3>
                                <div class="value" id="total-value">$0.00</div>
                            </div>
                            <div class="metric">
                                <h3>Daily P&L</h3>
                                <div class="value" id="daily-pnl">$0.00</div>
                            </div>
                            <div class="metric">
                                <h3>Total P&L</h3>
                                <div class="value" id="total-pnl">$0.00</div>
                            </div>
                            <div class="metric">
                                <h3>Positions</h3>
                                <div class="value" id="position-count">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Trading Status -->
                    <div class="card">
                        <h2>⚡ Trading Status</h2>
                        <div id="trading-status">
                            <p><span class="status-indicator status-offline" id="status-indicator"></span>
                               <span id="status-text">Offline</span></p>
                            <p>Market: <span id="market-status">Closed</span></p>
                            <p>Daily Trades: <span id="daily-trades">0</span></p>
                            <div class="trading-controls">
                                <button class="btn btn-success" id="start-trading-btn">Start Trading</button>
                                <button class="btn btn-danger" id="stop-trading-btn">Stop Trading</button>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Chart -->
                    <div class="card">
                        <h2>📈 Performance Chart</h2>
                        <div id="performance-chart" class="chart-container"></div>
                    </div>

                    <!-- Portfolio Positions -->
                    <div class="card">
                        <h2>💼 Portfolio Positions</h2>
                        <div id="positions-container">
                            <table class="positions-table" id="positions-table">
                                <thead>
                                    <tr>
                                        <th>Symbol</th>
                                        <th>Shares</th>
                                        <th>Avg Price</th>
                                        <th>Current Price</th>
                                        <th>P&L</th>
                                        <th>P&L %</th>
                                    </tr>
                                </thead>
                                <tbody id="positions-tbody">
                                    <tr>
                                        <td colspan="6" class="loading">Loading positions...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>



                    <!-- System Info -->
                    <div class="card">
                        <h2>⚙️ System Information</h2>
                        <div id="system-info">
                            <p><strong>Last Update:</strong> <span id="last-update">Never</span></p>
                            <p><strong>Data Engine:</strong> <span id="data-engine-status">Online</span></p>
                            <p><strong>ML Models:</strong> <span id="ml-status">Available</span></p>
                            <p><strong>Risk Management:</strong> <span id="risk-status">Active</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tickers & Scoring Tab -->
            <div id="tickers" class="tab-content" style="display: none; padding: 20px;">
                <div class="card">
                    <h2>📈 Tickers & Scoring</h2>
                    
                    <!-- Ticker Search and Add Section -->
                    <div id="ticker-search-section" style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; border: 4px solid #3498db; box-shadow: 0 8px 32px rgba(52, 152, 219, 0.3); position: relative;">
                        <div style="position: absolute; top: -10px; left: 20px; background: #3498db; color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: bold;">SEARCH AREA</div>
                        <h3 style="margin-bottom: 15px; color: white; font-size: 1.3em; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">🔍 Add New Ticker</h3>
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <input type="text" id="ticker-search" placeholder="Enter ticker symbol (e.g., AAPL, MSFT)" 
                                   style="flex: 1; min-width: 200px; padding: 15px; border: 3px solid #3498db; border-radius: 8px; font-size: 16px; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <button id="search-ticker-btn" class="btn btn-primary" style="padding: 15px 25px; font-weight: bold; font-size: 16px; background: #e74c3c; border: none; box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);">🔍 Search</button>
                            <button id="add-ticker-btn" class="btn btn-success" style="padding: 15px 25px; display: none; font-weight: bold; font-size: 16px; background: #27ae60; border: none; box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);">➕ Add to Watchlist</button>
                        </div>
                        <div id="search-results" style="margin-top: 15px; display: none;">
                            <!-- Search results will appear here -->
                        </div>
                    </div>
                    
                    <div id="tickers-container">
                        <table class="tickers-table" id="tickers-table">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Current Price</th>
                                    <th>Score</th>
                                    <th>MACD</th>
                                    <th>RSI</th>
                                    <th>EMA</th>
                                    <th>BB Position</th>
                                    <th>Volume</th>
                                    <th>Signal</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tickers-tbody">
                                <tr>
                                    <td colspan="10" class="loading">Loading tickers...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Trade History Tab -->
            <div id="trades" class="tab-content" style="display: none; padding: 20px;">
                <div class="card">
                    <h2>📋 Trade History</h2>
                    <div id="trades-container">
                        <table class="trades-table" id="trades-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Symbol</th>
                                    <th>Type</th>
                                    <th>Shares</th>
                                    <th>Price</th>
                                    <th>P&L</th>
                                    <th>Strategy</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="trades-tbody">
                                <tr>
                                    <td colspan="8" class="loading">Loading trades...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Backtesting Tab -->
            <div id="backtesting" class="tab-content" style="display: none; padding: 20px;">
                <div class="card">
                    <h2>🧪 Backtesting</h2>
                    <div id="backtest-form">
                        <div style="margin-bottom: 15px;">
                            <label for="backtest-symbol">Symbol:</label>
                            <select id="backtest-symbol" style="margin-left: 10px; padding: 5px;">
                                <option value="AAPL">AAPL</option>
                                <option value="MSFT">MSFT</option>
                                <option value="GOOGL">GOOGL</option>
                                <option value="TSLA">TSLA</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="backtest-strategy">Strategy:</label>
                            <select id="backtest-strategy" style="margin-left: 10px; padding: 5px;">
                                <option value="MACDStrategy">MACD Strategy</option>
                                <option value="MACDLoose">MACD Loose</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="run-backtest-btn">Run Backtest</button>
                    </div>
                    <div id="backtest-results" class="backtest-results" style="display: none;">
                        <h3>📊 Backtest Results</h3>
                        <div class="backtest-metrics" id="backtest-metrics">
                            <!-- Summary Metrics -->
                            <div class="backtest-summary" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                                <h4 style="margin-bottom: 10px; color: #2c3e50;">📈 Summary</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                    <div class="metric-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Total Trades</div>
                                        <div id="total-trades" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">0</div>
                                    </div>
                                    <div class="metric-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Total Return</div>
                                        <div id="total-return" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">0%</div>
                                    </div>
                                    <div class="metric-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Final Value</div>
                                        <div id="final-value" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">$0</div>
                                    </div>
                                    <div class="metric-card" style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 0.9em; color: #7f8c8d;">Sharpe Ratio</div>
                                        <div id="sharpe-ratio" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">0.00</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Trade Details -->
                            <div class="trade-details" style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px; color: #2c3e50;">📋 Trade Details</h4>
                                <div id="trade-details-container" style="max-height: 300px; overflow-y: auto;">
                                    <table class="trade-table" style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                                        <thead style="background: #34495e; color: white;">
                                            <tr>
                                                <th style="padding: 12px; text-align: left;">Trade #</th>
                                                <th style="padding: 12px; text-align: left;">Type</th>
                                                <th style="padding: 12px; text-align: left;">Shares</th>
                                                <th style="padding: 12px; text-align: left;">Buy Price</th>
                                                <th style="padding: 12px; text-align: left;">Sell Price</th>
                                                <th style="padding: 12px; text-align: left;">Gain/Loss</th>
                                                <th style="padding: 12px; text-align: left;">Gain/Loss %</th>
                                            </tr>
                                        </thead>
                                        <tbody id="trade-details-tbody">
                                            <tr>
                                                <td colspan="7" style="padding: 20px; text-align: center; color: #7f8c8d;">No trades executed</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- Performance Chart -->
                            <div class="performance-chart" style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px; color: #2c3e50;">📈 Performance Chart</h4>
                                <div id="backtest-chart" style="height: 300px; background: white; border-radius: 8px; padding: 20px;">
                                    <div style="text-align: center; color: #7f8c8d; padding-top: 120px;">Chart will appear here</div>
                                </div>
                            </div>
                            
                            <!-- Backtest Logs -->
                            <div class="backtest-logs" style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px; color: #2c3e50;">🖥️ Backtest Logs</h4>
                                <div id="backtest-log-container" style="background: #1e1e1e; color: #00ff00; font-family: 'Courier New', monospace; padding: 15px; border-radius: 8px; max-height: 300px; overflow-y: auto; font-size: 12px; border: 1px solid #333;">
                                    <div id="backtest-log-content">
                                        <span style="color: #888;">Waiting for backtest to start...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trade Detail Modal -->
    <div id="tradeModal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-modal-btn">&times;</span>
            <h2 id="modal-title">Trade Details</h2>
            <div id="modal-content">
                <!-- Trade details will be populated here -->
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
            console.log('loadTickersData called');
            const tbody = document.getElementById('tickers-tbody');
            if (!tbody) {
                console.error('tickers-tbody not found');
                return;
            }
            tbody.innerHTML = '<tr><td colspan="10" class="loading">Loading tickers...</td></tr>';

            // Simulate ticker data (in real implementation, this would come from API)
            const tickers = [
                { symbol: 'AAPL', price: 218.50, score: 85, macd: 'bullish', rsi: 65, ema: 'above', bb: 'upper', volume: 'high', signal: 'buy' },
                { symbol: 'MSFT', price: 415.20, score: 78, macd: 'neutral', rsi: 55, ema: 'above', bb: 'middle', volume: 'medium', signal: 'hold' },
                { symbol: 'GOOGL', price: 185.30, score: 92, macd: 'bullish', rsi: 70, ema: 'above', bb: 'upper', volume: 'high', signal: 'buy' },
                { symbol: 'TSLA', price: 245.80, score: 45, macd: 'bearish', rsi: 35, ema: 'below', bb: 'lower', volume: 'low', signal: 'sell' },
                { symbol: 'AMZN', price: 178.90, score: 67, macd: 'neutral', rsi: 50, ema: 'above', bb: 'middle', volume: 'medium', signal: 'hold' }
            ];

            updateTickersTable(tickers);
            console.log('Tickers data loaded successfully');
        }

        function loadTradesData() {
            const tbody = document.getElementById('trades-tbody');
            tbody.innerHTML = '<tr><td colspan="8" class="loading">Loading trades...</td></tr>';

            // Simulate trade data (in real implementation, this would come from API)
            const trades = [
                { date: '2025-07-14 10:30:15', symbol: 'AAPL', type: 'BUY', shares: 100, price: 218.50, pnl: 1250.00, strategy: 'MACD', status: 'closed' },
                { date: '2025-07-14 09:15:22', symbol: 'MSFT', type: 'SELL', shares: 50, price: 415.20, pnl: -450.00, strategy: 'MACD', status: 'closed' },
                { date: '2025-07-14 08:45:33', symbol: 'GOOGL', type: 'BUY', shares: 25, price: 185.30, pnl: 875.00, strategy: 'MACD', status: 'closed' },
                { date: '2025-07-13 16:20:45', symbol: 'TSLA', type: 'SELL', shares: 75, price: 245.80, pnl: -1200.00, strategy: 'MACD', status: 'closed' }
            ];

            updateTradesTable(trades);
        }

        function updateTickersTable(tickers) {
            const tbody = document.getElementById('tickers-tbody');
            tbody.innerHTML = '';

            tickers.forEach(ticker => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${ticker.symbol}</strong></td>
                    <td>$${ticker.price.toFixed(2)}</td>
                    <td><span class="score-badge ${getScoreClass(ticker.score)}">${ticker.score}</span></td>
                    <td><span class="indicator-status ${getIndicatorClass(ticker.macd)}">${ticker.macd}</span></td>
                    <td><span class="indicator-status ${getIndicatorClass(ticker.rsi)}">${ticker.rsi}</span></td>
                    <td><span class="indicator-status ${getIndicatorClass(ticker.ema)}">${ticker.ema}</span></td>
                    <td><span class="indicator-status ${getIndicatorClass(ticker.bb)}">${ticker.bb}</span></td>
                    <td><span class="indicator-status ${getIndicatorClass(ticker.volume)}">${ticker.volume}</span></td>
                    <td><span class="indicator-status ${getSignalClass(ticker.signal)}">${ticker.signal.toUpperCase()}</span></td>
                    <td>
                        <button class="btn btn-danger remove-ticker-btn" data-symbol="${ticker.symbol}" style="padding: 5px 10px; font-size: 12px;">Remove</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Add event listeners to remove buttons
            const removeButtons = tbody.querySelectorAll('.remove-ticker-btn');
            removeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const symbol = this.getAttribute('data-symbol');
                    removeTicker(symbol);
                });
            });
        }

        // Global variable to store current search result
        let currentSearchResult = null;

        function searchTicker() {
            const searchInput = document.getElementById('ticker-search');
            const symbol = searchInput.value.trim().toUpperCase();
            const searchResults = document.getElementById('search-results');
            const addTickerBtn = document.getElementById('add-ticker-btn');

            if (!symbol) {
                showMessage('Please enter a ticker symbol', 'error');
                return;
            }

            // Show loading state
            searchResults.innerHTML = '<div class="loading">Searching for ticker...</div>';
            searchResults.style.display = 'block';
            addTickerBtn.style.display = 'none';

            // Simulate API call to search for ticker
            // In real implementation, this would call your backend API
            setTimeout(() => {
                // Simulate finding ticker data
                const mockTickerData = {
                    symbol: symbol,
                    name: `${symbol} Company`,
                    price: Math.random() * 500 + 50,
                    change: (Math.random() - 0.5) * 10,
                    volume: Math.floor(Math.random() * 1000000),
                    marketCap: Math.floor(Math.random() * 1000000000)
                };

                currentSearchResult = mockTickerData;
                
                searchResults.innerHTML = `
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
                        <h4 style="margin-bottom: 10px; color: #2c3e50;">${mockTickerData.name} (${mockTickerData.symbol})</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                            <div>
                                <strong>Price:</strong> $${mockTickerData.price.toFixed(2)}
                            </div>
                            <div>
                                <strong>Change:</strong> 
                                <span class="${mockTickerData.change >= 0 ? 'positive' : 'negative'}">
                                    ${mockTickerData.change >= 0 ? '+' : ''}$${mockTickerData.change.toFixed(2)}
                                </span>
                            </div>
                            <div>
                                <strong>Volume:</strong> ${mockTickerData.volume.toLocaleString()}
                            </div>
                            <div>
                                <strong>Market Cap:</strong> $${(mockTickerData.marketCap / 1000000).toFixed(1)}M
                            </div>
                        </div>
                    </div>
                `;
                
                addTickerBtn.style.display = 'inline-block';
            }, 1000);
        }

        function addTickerToWatchlist() {
            if (!currentSearchResult) {
                showMessage('No ticker selected', 'error');
                return;
            }

            // In real implementation, this would call your backend API to add the ticker
            console.log('Adding ticker to watchlist:', currentSearchResult.symbol);
            
            // Simulate adding to watchlist
            const newTicker = {
                symbol: currentSearchResult.symbol,
                price: currentSearchResult.price,
                score: Math.floor(Math.random() * 100),
                macd: ['bullish', 'bearish', 'neutral'][Math.floor(Math.random() * 3)],
                rsi: Math.floor(Math.random() * 100),
                ema: ['above', 'below', 'middle'][Math.floor(Math.random() * 3)],
                bb: ['upper', 'lower', 'middle'][Math.floor(Math.random() * 3)],
                volume: ['high', 'medium', 'low'][Math.floor(Math.random() * 3)],
                signal: ['buy', 'sell', 'hold'][Math.floor(Math.random() * 3)]
            };

            // Add to current tickers list (in real implementation, this would be stored in backend)
            const currentTickers = getCurrentTickers();
            currentTickers.push(newTicker);
            updateTickersTable(currentTickers);

            // Clear search
            document.getElementById('ticker-search').value = '';
            document.getElementById('search-results').style.display = 'none';
            document.getElementById('add-ticker-btn').style.display = 'none';
            currentSearchResult = null;

            showMessage(`Added ${newTicker.symbol} to watchlist`, 'success');
        }

        function removeTicker(symbol) {
            // In real implementation, this would call your backend API to remove the ticker
            console.log('Removing ticker from watchlist:', symbol);
            
            const currentTickers = getCurrentTickers();
            const updatedTickers = currentTickers.filter(ticker => ticker.symbol !== symbol);
            updateTickersTable(updatedTickers);

            showMessage(`Removed ${symbol} from watchlist`, 'success');
        }

        function getCurrentTickers() {
            // In real implementation, this would come from your backend API
            // For now, return the default tickers
            return [
                { symbol: 'AAPL', price: 218.50, score: 85, macd: 'bullish', rsi: 65, ema: 'above', bb: 'upper', volume: 'high', signal: 'buy' },
                { symbol: 'MSFT', price: 415.20, score: 78, macd: 'neutral', rsi: 55, ema: 'above', bb: 'middle', volume: 'medium', signal: 'hold' },
                { symbol: 'GOOGL', price: 185.30, score: 92, macd: 'bullish', rsi: 70, ema: 'above', bb: 'upper', volume: 'high', signal: 'buy' },
                { symbol: 'TSLA', price: 245.80, score: 45, macd: 'bearish', rsi: 35, ema: 'below', bb: 'lower', volume: 'low', signal: 'sell' },
                { symbol: 'AMZN', price: 178.90, score: 67, macd: 'neutral', rsi: 50, ema: 'above', bb: 'middle', volume: 'medium', signal: 'hold' }
            ];
        }

        function updateTradesTable(trades) {
            const tbody = document.getElementById('trades-tbody');
            tbody.innerHTML = '';

            trades.forEach((trade, index) => {
                const row = document.createElement('tr');
                row.addEventListener('click', () => showTradeDetails(trade));
                row.style.cursor = 'pointer';
                
                row.innerHTML = `
                    <td>${trade.date}</td>
                    <td><strong>${trade.symbol}</strong></td>
                    <td><span class="indicator-status ${trade.type === 'BUY' ? 'indicator-bullish' : 'indicator-bearish'}">${trade.type}</span></td>
                    <td>${trade.shares}</td>
                    <td>$${trade.price.toFixed(2)}</td>
                    <td class="${trade.pnl >= 0 ? 'positive' : 'negative'}">$${trade.pnl.toFixed(2)}</td>
                    <td>${trade.strategy}</td>
                    <td><span class="indicator-status ${trade.status === 'closed' ? 'indicator-bullish' : 'indicator-neutral'}">${trade.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function getScoreClass(score) {
            if (score >= 80) return 'score-high';
            if (score >= 60) return 'score-medium';
            return 'score-low';
        }

        function getIndicatorClass(indicator) {
            if (indicator === 'bullish' || indicator === 'above' || indicator === 'upper' || indicator === 'high') return 'indicator-bullish';
            if (indicator === 'bearish' || indicator === 'below' || indicator === 'lower' || indicator === 'low') return 'indicator-bearish';
            return 'indicator-neutral';
        }

        function getSignalClass(signal) {
            if (signal === 'buy') return 'indicator-bullish';
            if (signal === 'sell') return 'indicator-bearish';
            return 'indicator-neutral';
        }

        function showTradeDetails(trade) {
            const modal = document.getElementById('tradeModal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');

            title.textContent = `Trade Details - ${trade.symbol}`;
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h3>Trade Information</h3>
                        <p><strong>Date:</strong> ${trade.date}</p>
                        <p><strong>Symbol:</strong> ${trade.symbol}</p>
                        <p><strong>Type:</strong> ${trade.type}</p>
                        <p><strong>Shares:</strong> ${trade.shares}</p>
                        <p><strong>Price:</strong> $${trade.price.toFixed(2)}</p>
                        <p><strong>Strategy:</strong> ${trade.strategy}</p>
                        <p><strong>Status:</strong> ${trade.status}</p>
                    </div>
                    <div>
                        <h3>Performance</h3>
                        <p><strong>P&L:</strong> <span class="${trade.pnl >= 0 ? 'positive' : 'negative'}">$${trade.pnl.toFixed(2)}</span></p>
                        <p><strong>P&L %:</strong> <span class="${trade.pnl >= 0 ? 'positive' : 'negative'}">${((trade.pnl / (trade.price * trade.shares)) * 100).toFixed(2)}%</span></p>
                        <p><strong>Total Value:</strong> $${(trade.price * trade.shares).toFixed(2)}</p>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h3>Trade Analysis</h3>
                    <p>This trade was executed based on ${trade.strategy} signals. The ${trade.type.toLowerCase()} order was placed at $${trade.price.toFixed(2)} per share for ${trade.shares} shares.</p>
                    <p>The trade resulted in a ${trade.pnl >= 0 ? 'profit' : 'loss'} of $${Math.abs(trade.pnl).toFixed(2)}.</p>
                </div>
            `;

            modal.style.display = 'block';
        }

        function closeTradeModal() {
            document.getElementById('tradeModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('tradeModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        function setupSocketListeners() {
            socket.on('portfolio_update', function(data) {
                updatePortfolioDisplay(data);
            });

            socket.on('trading_status_update', function(data) {
                updateTradingStatus(data);
            });
        }

        function updatePortfolioDisplay(data) {
            if (data.error) {
                showError(data.error);
                return;
            }

            document.getElementById('total-value').textContent = formatCurrency(data.total_value || 0);
            document.getElementById('daily-pnl').textContent = formatCurrency(data.daily_pnl || 0);
            document.getElementById('total-pnl').textContent = formatCurrency(data.total_pnl || 0);
            document.getElementById('position-count').textContent = data.positions ? Object.keys(data.positions).length : 0;

            // Update P&L colors
            const dailyPnlElement = document.getElementById('daily-pnl');
            const totalPnlElement = document.getElementById('total-pnl');
            
            dailyPnlElement.className = 'value ' + (data.daily_pnl >= 0 ? 'positive' : 'negative');
            totalPnlElement.className = 'value ' + (data.total_pnl >= 0 ? 'positive' : 'negative');

            // Update positions table
            updatePositionsTable(data.positions || {});
        }

        function updateTradingStatus(data) {
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const marketStatus = document.getElementById('market-status');
            const dailyTrades = document.getElementById('daily-trades');

            if (data.is_running) {
                statusIndicator.className = 'status-indicator status-online';
                statusText.textContent = 'Online';
            } else {
                statusIndicator.className = 'status-indicator status-offline';
                statusText.textContent = 'Offline';
            }

            marketStatus.textContent = data.market_open ? 'Open' : 'Closed';
            dailyTrades.textContent = data.daily_trades || 0;
        }

        function updatePositionsTable(positions) {
            const tbody = document.getElementById('positions-tbody');
            tbody.innerHTML = '';

            if (Object.keys(positions).length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No positions</td></tr>';
                return;
            }

            Object.entries(positions).forEach(([symbol, position]) => {
                const row = document.createElement('tr');
                const pnl = position.current_value - position.cost_basis;
                const pnlPercent = (pnl / position.cost_basis) * 100;

                row.innerHTML = `
                    <td><strong>${symbol}</strong></td>
                    <td>${position.shares}</td>
                    <td>${formatCurrency(position.avg_price)}</td>
                    <td>${formatCurrency(position.current_price)}</td>
                    <td class="${pnl >= 0 ? 'positive' : 'negative'}">${formatCurrency(pnl)}</td>
                    <td class="${pnl >= 0 ? 'positive' : 'negative'}">${pnlPercent.toFixed(2)}%</td>
                `;
                tbody.appendChild(row);
            });
        }

        function startTrading() {
            fetch('/api/trading/start', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'started') {
                    showMessage('Trading started successfully', 'success');
                } else {
                    showMessage(data.status, 'info');
                }
            })
            .catch(error => {
                console.error('Error starting trading:', error);
                showError('Failed to start trading');
            });
        }

        function stopTrading() {
            fetch('/api/trading/stop', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'stopped') {
                    showMessage('Trading stopped successfully', 'success');
                } else {
                    showMessage(data.status, 'info');
                }
            })
            .catch(error => {
                console.error('Error stopping trading:', error);
                showError('Failed to stop trading');
            });
        }

        function showBacktestingTabAndDisplayResults(results, container) {
            console.log('Backtest results received:', results);
            
            // Switch to backtesting tab immediately
            const backtestingTabButton = document.querySelector('[data-tab="backtesting"]');
            if (backtestingTabButton) {
                showTab('backtesting', backtestingTabButton);
            }

            // Display results immediately after a short delay
            setTimeout(() => {
                displayBacktestResults(results, container);
            }, 100);
        }

        function runBacktest() {
            const symbol = document.getElementById('backtest-symbol').value;
            const strategy = document.getElementById('backtest-strategy').value;
            const resultsDiv = document.getElementById('backtest-results');
            const metricsDiv = document.getElementById('backtest-metrics');
            const logContainer = document.getElementById('backtest-log-content');

            resultsDiv.style.display = 'block';
            metricsDiv.innerHTML = '<div class="loading">Running backtest...</div>';
            
            // Clear and initialize log display
            if (logContainer) {
                logContainer.innerHTML = '<span style="color: #00ff00;">🚀 Starting backtest for ' + symbol + ' with ' + strategy + ' strategy...</span><br>';
            }

            fetch('/api/backtest', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    symbol: symbol,
                    strategy: strategy,
                    start_date: '2023-01-01',
                    end_date: '2023-12-31'
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Backtest response received:', data);
                if (data.error) {
                    metricsDiv.innerHTML = `<div class="error">${data.error}</div>`;
                    if (logContainer) {
                        logContainer.innerHTML += '<span style="color: #ff0000;">❌ Error: ' + data.error + '</span><br>';
                    }
                } else {
                    // Switch to backtesting tab immediately
                    const backtestingTabButton = document.querySelector('[data-tab="backtesting"]');
                    if (backtestingTabButton) {
                        showTab('backtesting', backtestingTabButton);
                    }
                    
                    // Add completion log
                    if (logContainer) {
                        logContainer.innerHTML += '<span style="color: #00ff00;">✅ Backtest completed successfully!</span><br>';
                        logContainer.innerHTML += '<span style="color: #00ff00;">📊 Total trades: ' + (data.total_trades || 0) + '</span><br>';
                        logContainer.innerHTML += '<span style="color: #00ff00;">💰 Final return: ' + (data.total_return_pct || 0).toFixed(2) + '%</span><br>';
                    }
                    
                    // Display results immediately
                    displayBacktestResults(data, metricsDiv);
                }
            })
            .catch(error => {
                console.error('Error running backtest:', error);
                metricsDiv.innerHTML = '<div class="error">Failed to run backtest</div>';
            });
        }

        function displayBacktestResults(results, container) {
            console.log('displayBacktestResults called with:', results);
            
            // Make backtest results visible
            const backtestResultsElement = document.getElementById('backtest-results');
            if (backtestResultsElement) {
                backtestResultsElement.style.display = 'block';
            }
            
            // Parse results
            const metrics = results.performance_metrics || {};
            const trades = results.trade_log || [];
            const totalTrades = results.total_trades || 0;
            const finalEquity = results.final_capital || results.initial_capital || 0;
            const totalReturn = results.total_return_pct || metrics.total_return || 0;
            const sharpeRatio = metrics.sharpe_ratio || 0;
            
            console.log('Parsed data:', { totalTrades, finalEquity, totalReturn, sharpeRatio, tradesCount: trades.length });
            
            // Update summary metrics
            const totalTradesElement = document.getElementById('total-trades');
            const totalReturnElement = document.getElementById('total-return');
            const finalValueElement = document.getElementById('final-value');
            const sharpeRatioElement = document.getElementById('sharpe-ratio');
            
            if (totalTradesElement) totalTradesElement.textContent = totalTrades;
            if (totalReturnElement) {
                totalReturnElement.textContent = `${totalReturn.toFixed(2)}%`;
                totalReturnElement.style.color = totalReturn >= 0 ? '#27ae60' : '#e74c3c';
            }
            if (finalValueElement) finalValueElement.textContent = formatCurrency(finalEquity);
            if (sharpeRatioElement) sharpeRatioElement.textContent = sharpeRatio.toFixed(3);
            
            // Update trade details table
            const tradeTbody = document.getElementById('trade-details-tbody');
            if (tradeTbody) {
                tradeTbody.innerHTML = '';
                
                if (trades.length === 0) {
                    tradeTbody.innerHTML = '<tr><td colspan="6" style="padding: 20px; text-align: center; color: #7f8c8d;">No trades executed</td></tr>';
                } else {
                    console.log('Displaying', trades.length, 'trades');
                    
                    // Group trades by entry/exit pairs
                    const tradePairs = [];
                    let currentBuy = null;
                    
                    for (const trade of trades) {
                        if (trade.type === 'BUY') {
                            currentBuy = trade;
                        } else if (trade.type === 'SELL' && currentBuy) {
                            tradePairs.push({
                                buy: currentBuy,
                                sell: trade
                            });
                            currentBuy = null;
                        }
                    }
                    
                    console.log('Trade pairs:', tradePairs);
                    
                    if (tradePairs.length === 0) {
                        tradeTbody.innerHTML = '<tr><td colspan="6" style="padding: 20px; text-align: center; color: #7f8c8d;">No completed trades</td></tr>';
                    } else {
                        // Add trade logs to CLI display
                        const logContainer = document.getElementById('backtest-log-content');
                        if (logContainer) {
                            logContainer.innerHTML += '<span style="color: #ffff00;">📋 Processing ' + tradePairs.length + ' completed trades...</span><br>';
                        }
                        
                        tradePairs.forEach((pair, index) => {
                            console.log('Processing trade pair:', pair);
                            
                            const buyPrice = pair.buy.price || 0;
                            const sellPrice = pair.sell.price || 0;
                            const shares = pair.buy.shares || 0;
                            const pnlPct = pair.sell.pnl_pct || 0;
                            const pnlDollars = pair.sell.pnl_dollars || 0;
                            
                            // Add trade log
                            if (logContainer) {
                                const logColor = pnlPct >= 0 ? '#00ff00' : '#ff0000';
                                logContainer.innerHTML += `<span style="color: ${logColor};">💰 Trade ${index + 1}: BUY ${shares.toFixed(2)} shares at $${buyPrice.toFixed(2)} → SELL at $${sellPrice.toFixed(2)} (${pnlPct.toFixed(2)}%)</span><br>`;
                            }
                            
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td style="padding: 12px; border-bottom: 1px solid #ecf0f1;">${index + 1}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #ecf0f1;">${pair.buy.date || 'N/A'}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #ecf0f1;">${formatCurrency(buyPrice)}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #ecf0f1;">${formatCurrency(sellPrice)}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #ecf0f1;">${shares.toFixed(2)}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #ecf0f1;" class="${pnlPct >= 0 ? 'text-success' : 'text-danger'}">${pnlPct.toFixed(2)}%</td>
                            `;
                            tradeTbody.appendChild(row);
                        });
                        
                        if (logContainer) {
                            logContainer.innerHTML += '<span style="color: #00ff00;">✅ All trades processed and displayed!</span><br>';
                        }
                    }
                }
            }
            
            console.log('Backtest results display completed');
        }
        

        


        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function updateLastUpdate() {
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
            setTimeout(updateLastUpdate, 60000); // Update every minute
        }

        function showMessage(message, type) {
            // Simple message display - you could enhance this with a toast notification
            console.log(`${type.toUpperCase()}: ${message}`);
        }

        function showError(message) {
            console.error('ERROR:', message);
        }

        // Test function to check search area visibility
        function testSearchArea() {
            console.log('=== TESTING SEARCH AREA ===');
            const searchSection = document.getElementById('ticker-search-section');
            const searchInput = document.getElementById('ticker-search');
            const searchBtn = document.getElementById('search-ticker-btn');
            const addBtn = document.getElementById('add-ticker-btn');
            
            console.log('Search section exists:', !!searchSection);
            console.log('Search input exists:', !!searchInput);
            console.log('Search button exists:', !!searchBtn);
            console.log('Add button exists:', !!addBtn);
            
            if (searchSection) {
                console.log('Search section display:', searchSection.style.display);
                console.log('Search section visibility:', searchSection.style.visibility);
                console.log('Search section opacity:', searchSection.style.opacity);
                console.log('Search section computed style:', window.getComputedStyle(searchSection).display);
            }
            
            // Force make it visible
            if (searchSection) {
                searchSection.style.display = 'block';
                searchSection.style.visibility = 'visible';
                searchSection.style.opacity = '1';
                searchSection.style.position = 'relative';
                searchSection.style.zIndex = '1000';
                console.log('Forced search section to be visible');
            }
            
            console.log('=== END TEST ===');
        }

        // Setup search functionality event listeners
        function setupSearchEventListeners() {
            console.log('Setting up search event listeners...');
            
            const searchBtn = document.getElementById('search-ticker-btn');
            const addBtn = document.getElementById('add-ticker-btn');
            
            if (searchBtn) {
                searchBtn.addEventListener('click', function() {
                    console.log('Search button clicked');
                    searchTicker();
                });
                console.log('Search button listener added');
            } else {
                console.error('Search button not found');
            }
            
            if (addBtn) {
                addBtn.addEventListener('click', function() {
                    console.log('Add button clicked');
                    addTickerToWatchlist();
                });
                console.log('Add button listener added');
            } else {
                console.error('Add button not found');
            }
            
            // Add enter key support for search input
            const searchInput = document.getElementById('ticker-search');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        console.log('Enter key pressed in search input');
                        searchTicker();
                    }
                });
                console.log('Search input listener added');
            } else {
                console.error('Search input not found');
            }
            
            // Test the search area
            setTimeout(testSearchArea, 1000);
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing dashboard...');
            setupTabNavigation();
            setupButtonEventListeners();
            setupSearchEventListeners();
            loadInitialData();
            setupSocketListeners();
            updateLastUpdate();
            console.log('Dashboard initialization complete');
        });

        // Also try to initialize immediately if DOM is already loaded
        if (document.readyState === 'loading') {
            console.log('DOM still loading, will initialize when ready');
        } else {
            console.log('DOM already loaded, initializing immediately...');
            setupTabNavigation();
            setupButtonEventListeners();
            setupSearchEventListeners();
            loadInitialData();
            setupSocketListeners();
            updateLastUpdate();
            console.log('Dashboard initialization complete (immediate)');
        }

        // Add a simple test to check if search area exists
        setTimeout(function() {
            console.log('=== SEARCH AREA TEST ===');
            const searchSection = document.getElementById('ticker-search-section');
            console.log('Search section exists:', !!searchSection);
            if (searchSection) {
                console.log('Search section HTML:', searchSection.outerHTML.substring(0, 200) + '...');
            }
            console.log('=== END SEARCH AREA TEST ===');
        }, 2000);
    </script>
</body>
</html> 